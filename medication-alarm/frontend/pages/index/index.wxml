<view class="container">
  <!-- Header Section -->
  <view class="header-section">
    <view class="user-profile">
      <block wx:if="{{!hasUserInfo}}">
        <view class="login-placeholder" bindtap="getUserProfile">
          <view class="avatar-circle">
            <text>æœªç™»å½•</text>
          </view>
          <view class="greeting">
            <text class="h1">ç‚¹å‡»ç™»å½•</text>
            <text class="p">å¼€å¯æ‚¨çš„å¥åº·ç®¡ç†</text>
          </view>
        </view>
      </block>
      <block wx:else>
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="greeting">
          <text class="h1">ä½ å¥½ï¼Œ{{userInfo.nickName}}</text>
          <text class="p">ç¥æ‚¨èº«ä½“å¥åº·</text>
        </view>
      </block>
    </view>
  </view>

  <!-- Dashboard Stats -->
  <view class="card dashboard">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥æ¦‚è§ˆ</text>
      <text class="date-badge">{{todayDate}}</text>
    </view>
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-val">{{stats.pending}}</text>
        <text class="stat-key">å¾…æœè¯</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-val success">{{stats.completed}}</text>
        <text class="stat-key">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- Schedule List -->
  <view class="section-title">ä»Šæ—¥æœè¯è®¡åˆ’</view>
  <view class="schedule-list">
    <block wx:if="{{schedule.length === 0}}">
      <view class="empty-state">
        <text>ä»Šå¤©æ²¡æœ‰æœè¯è®¡åˆ’</text>
      </view>
    </block>
    <block wx:else>
      <view class="schedule-item" wx:for="{{schedule}}" wx:key="plan_id">
        <view class="time-col">
          <text class="time-text">{{item.time}}</text>
          <view class="time-line"></view>
        </view>
        <view class="med-card {{item.status === 'taken' ? 'done' : ''}}">
          <view class="med-info">
            <text class="med-name" style="color: {{item.medication_color}}">{{item.medication_name}}</text>
            <text class="med-dose">{{item.dosage}}{{item.medication_unit}}</text>
          </view>
          <view class="med-action">
            <button 
              class="btn-take {{item.status === 'taken' ? 'taken' : ''}}" 
              bindtap="takeMedication" 
              data-plan-id="{{item.plan_id}}"
              data-medication-id="{{item.medication_id}}"
            >
              {{item.status === 'taken' ? 'å·²æœ' : 'æ‰“å¡'}}
            </button>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- Quick Actions -->
  <view class="action-grid" id="guide-target-1">
    <view class="action-card" bindtap="goToMedications">
      <view class="icon-box blue">
        <text>ğŸ’Š</text>
      </view>
      <view class="action-info">
        <text class="action-name">æˆ‘çš„è¯ç®±</text>
        <text class="action-desc">ç®¡ç†è¯å“ä¸åº“å­˜</text>
      </view>
      <view class="arrow">></view>
    </view>
  </view>

  <!-- Spotlight Guide -->
  <view class="guide-overlay" wx:if="{{showGuide}}">
    <view class="guide-mask"></view>
    <view class="guide-content" style="top: {{guidePosition.top}}px; left: {{guidePosition.left}}px;">
      <view class="spotlight-circle"></view>
      <view class="guide-text-box">
        <text class="guide-title">{{guideSteps[currentStep].title}}</text>
        <text class="guide-desc">{{guideSteps[currentStep].desc}}</text>
        <view class="guide-actions">
           <button class="btn-skip" bindtap="skipGuide">è·³è¿‡</button>
           <button class="btn-next" bindtap="nextGuideStep">{{currentStep === guideSteps.length - 1 ? 'å®Œæˆ' : 'ä¸‹ä¸€æ­¥'}}</button>
        </view>
      </view>
    </view>
  </view>
</view>
