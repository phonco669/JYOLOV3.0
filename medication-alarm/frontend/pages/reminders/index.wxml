<view class="container">
  <view class="header">
    <text class="title">æé†’äº‹é¡¹</text>
    <text class="subtitle">ç®¡ç†æ‚¨çš„æ‰€æœ‰å¥åº·æé†’</text>
  </view>

  <view class="tabs">
    <view class="tab-item {{activeTab === 'pending' ? 'active' : ''}}" bindtap="switchTab" data-tab="pending">å¾…åŠäº‹é¡¹</view>
    <view class="tab-item {{activeTab === 'completed' ? 'active' : ''}}" bindtap="switchTab" data-tab="completed">å·²å®Œæˆ</view>
  </view>

  <scroll-view scroll-y class="reminder-list">
    <block wx:if="{{reminders.length === 0 && !loading}}">
      <view class="empty-state">
        <text>{{activeTab === 'pending' ? 'æš‚æ— å¾…åŠæé†’' : 'æš‚æ— å·²å®Œæˆäº‹é¡¹'}}</text>
      </view>
    </block>
    
    <block wx:else>
      <view class="reminder-card {{item.type}}" wx:for="{{reminders}}" wx:key="id" bindtap="{{activeTab === 'pending' ? 'markDone' : ''}}" data-id="{{item.id}}" data-type="{{item.type}}">
        <view class="card-left">
          <view class="icon-box {{item.type}}">
            <text wx:if="{{item.type === 'stock_low'}}">ğŸ“¦</text>
            <text wx:elif="{{item.type === 'todo'}}">ğŸ“</text>
            <text wx:else>â°</text>
          </view>
          <view class="content">
            <text class="card-title" style="{{activeTab === 'completed' ? 'text-decoration: line-through; color: #94A3B8;' : ''}}">{{item.title}}</text>
            <text class="card-detail">{{item.detail}}</text>
            <text class="card-time" wx:if="{{item.due_time}}">æˆªæ­¢: {{item.due_time}}</text>
          </view>
        </view>
        <view class="card-right">
           <block wx:if="{{activeTab === 'pending'}}">
             <view class="action-btn edit" catchtap="editTodo" data-item="{{item}}" wx:if="{{item.type === 'todo'}}">âœï¸</view>
             <view class="priority-dot {{item.priority}}"></view>
           </block>
           <block wx:else>
             <view class="action-btn undo" catchtap="undoComplete" data-id="{{item.id}}" data-type="{{item.type}}">â†©ï¸</view>
           </block>
        </view>
      </view>
    </block>
  </scroll-view>

  <view class="fab" bindtap="openAddModal" wx:if="{{activeTab === 'pending'}}">
    <text>+</text>
  </view>

  <!-- Modal -->
  <view class="modal-mask" wx:if="{{showModal}}" bindtap="closeModal"></view>
  <view class="modal-content" wx:if="{{showModal}}">
    <view class="modal-header">{{editingId ? 'ç¼–è¾‘å¾…åŠ' : 'æ–°å»ºå¾…åŠ'}}</view>
    <view class="form-group">
      <input class="input" placeholder="æ ‡é¢˜" value="{{newTodo.title}}" data-field="title" bindinput="onInputChange" />
    </view>
    <view class="form-group">
      <textarea class="textarea" placeholder="æè¿° (å¯é€‰)" value="{{newTodo.description}}" data-field="description" bindinput="onInputChange"></textarea>
    </view>
    <view class="form-row">
      <picker mode="date" value="{{newTodo.due_date}}" start="{{today}}" data-field="due_date" bindchange="onInputChange">
        <view class="picker">{{newTodo.due_date || 'é€‰æ‹©æ—¥æœŸ'}}</view>
      </picker>
      <picker mode="time" value="{{newTodo.time}}" data-field="time" bindchange="onInputChange">
        <view class="picker">{{newTodo.time || 'é€‰æ‹©æ—¶é—´'}}</view>
      </picker>
    </view>
    <view class="modal-actions">
      <button class="btn cancel" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="btn confirm" bindtap="submitTodo">ä¿å­˜</button>
    </view>
  </view>
</view>
